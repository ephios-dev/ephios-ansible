[uwsgi]
base = /home/{{ ansible_user }}/.local/lib/python3.8/site-packages/ephios

http = :8000
master = true
wsgi-file = %(base)/wsgi.py
touch-reload = %(wsgi-file)
static-map = /static=%(base)/static

app = wsgi

plugin = python

uid = {{ ansible_user }}
gid = {{ ansible_user }}


env = SECRET_KEY={{ django_secret }}
env = DEBUG=False

env = DATABASE_URL={{ database_url }}

env = ALLOWED_HOSTS={{ domains|join(",") if use_main_documentroot else domain }}
env = STATIC_URL=/static/
env = STATIC_ROOT=/var/www/virtual/{{ ansible_user }}/{{ "html" if use_main_documentroot else domain }}/static/
env = STATIC_ROOT=/var/www/virtual/{{ ansible_user }}/{{ "html" if use_main_documentroot else domain }}/static/

{% if not use_main_documentroot %}
env = SITE_URL=https://{{ domain }}
{% endif %}

env = EMAIL_URL=smtp+tls://{{ smtp_mailbox }}@{{ smtp_domain or domain }}:{{ smtp_password }}@{{ ansible_host }}:587

env = DEFAULT_FROM_EMAIL={{ smtp_mailbox }}@{{ smtp_domain or domain }}
env = SERVER_EMAIL={{ smtp_mailbox}}@{{ smtp_domain or domain }}

env = ADMINS="{{ admin_email }}"

env = CACHE_URL=redis:///home/{{ ansible_user }}/.redis/sock

env = VAPID_PRIVATE_KEY_PATH=/home/{{ ansible_user }}/private_key.pem